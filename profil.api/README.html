<!DOCTYPE html>
<html>
<head>
    <title>.Net core Web Api Projektanteckningar/Steps</title>
</head>
<body>

    <h1 id="net-core-web-api-projektanteckningarsteps">.Net core Web Api Projektanteckningar/Steps</h1>
<h3 id="projektkrav">Projektkrav</h3>
<p>Applikationen ska visa en lista av konsultprofiler</p>
<ul>
<li>En profil består av Förnamn, Efternamn och en Beskrivning</li>
</ul>
<p>Som en anonym användare kan jag</p>
<ul>
<li>Registrera mig</li>
<li>Se förnamn på profilerna</li>
</ul>
<p>Som en registrerad användare kan jag</p>
<ul>
<li>Se all information i konsultprofilerna</li>
</ul>
<h2 id="skapa-nytt-projekt-for-api">Skapa nytt projekt för API</h2>
<ul>
<li><p>Lägg till nytt projekt, ASP.NET Core Web Application (.NET Core)
ange namn, profil.api, välj Empty template.</p>
</li>
<li><p>Starta appen i Debug för att verifera att du får upp en browser med meddelandet &quot;Hello World!&quot;</p>
</li>
</ul>
<p>I <a href="Program.cs">Program.cs</a> finns inställningarna för webbservern, t ex om vi vill köra IIS Express eller något annat, vi låter dessa vara som de är.</p>
<p>I <a href="Startup.cs">Startup.cs</a>  konfigurerar man &quot;service dependencies&quot; (i metoden ConfigureServices) och  HTTP Request pipeline (i metoden Configure)</p>
<h4 id="http-request-pipeline">Http Request pipeline</h4>
<p><em>i Startup.cs &gt; Configure</em></p>
<ul>
<li><p>Http Request pipeline består av ett antal &quot;middlewares&quot; vilka kopplas på IApplicationBuilder (app)
vanliga  middelwares hämtar du från nuget, och du kan så klart skriva egna.</p>
</li>
<li><p>Ordningen för middlewares är viktig eftersom en middleware tar emot data från föregående middleware,
gör sin grej och skickar sedan vidare data till nästa i &quot;pipen&quot; (kedjan) [mw 1, mw 2, mw 3] och lyssnar (eventuellt) på resultatet från den/de senare i kedjan [mw 3, mw 2, mw 1]</p>
</li>
<li><p>Vissa middelwares är &quot;terminal&quot; vilket betyder att de inte skickar data vidare, de är sist i kedjan;
några exempel är UseWelcomePage() och Run(), alla middlewares configurerade senare i kedjan kommer alltså inte att köras.</p>
</li>
</ul>
<h4 id="oppna-startup.cs">Öppna <a href="Startup.cs">Startup.cs</a></h4>
<ul>
<li>och lägg till ett repository för att hämta konsultprofilerna</li>
<li>med repositoryt <a href="ConsultantProfileRepository.cs">ConsultantProfileRepository.cs</a> på plats kan vi lägga till en controller för att låta vårt api hämta data.</li>
<li>för att controllern ska hittas behövs routing, det kan man sätta direkt på controllern som vi visar i koden, alternativt i Startup.cs &gt; Configure (eller både och, controllerns konfig väger tyngst)
exempel:
<pre><code>  private void ConfigureRoutes(IRouteBuilder routeBuilder)
  		{
  			routeBuilder.MapRoute(&quot;Default&quot;,
  				&quot;{controller=Home}/{action=Index}/{id?}&quot;); // controller=Home &gt;&gt; om controller name inte hittas (eller inte angavs), redirect till HomeController med default action(metod) Index
  		}
  // används i Configure enligt, app.UseMvc(ConfigureRoutes)
</code></pre>
</li>
<li>nu har vi ett fungerande api som kan leverera konsultprofiler, nästa steg är att lägga till autentisering vilket vi gör med .Net Core Identity och <a href="https://github.com/IdentityServer/IdentityServer4">Identity Server 4</a></li>
</ul>
<h2 id="nytt-projekt-for-identityserver-och.net-core-identity">Nytt projekt för IdentityServer och .Net Core Identity</h2>
<p>Här följer jag exemplet från <a href="https://identityserver4.readthedocs.io/en/release/quickstarts/6_aspnet_identity.html">https://identityserver4.readthedocs.io/en/release/quickstarts/6_aspnet_identity.html</a> , (det finns även ett exempelprojekt här <a href="https://github.com/IdentityServer/IdentityServer4.Samples/tree/dev/Quickstarts/6_AspNetIdentity">https://github.com/IdentityServer/IdentityServer4.Samples/tree/dev/Quickstarts/6_AspNetIdentity</a>),
med deras färdiga UI <a href="https://github.com/IdentityServer/IdentityServer4.Quickstart.UI">https://github.com/IdentityServer/IdentityServer4.Quickstart.UI</a></p>


</body>
</html>